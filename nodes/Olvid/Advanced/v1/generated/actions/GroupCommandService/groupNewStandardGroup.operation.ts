// @generated by protoc-gen-n8n-actions v1 with parameter "target=ts"
// @generated from file olvid/daemon/services/v1/command_service.proto (package olvid.daemon.services.v1, syntax proto3)
/* eslint-disable */

import { type IExecuteFunctions, type INodeExecutionData, type IDataObject, type INodeProperties, updateDisplayOptions } from 'n8n-workflow';

// noinspection ES6UnusedImports
import { datatypes, OlvidClient, commands } from '@olvid/bot-node';

const properties: INodeProperties[] = [
  {
    displayName: 'Name',
    name: 'name',
    type: 'string',
    required: false,

    default: '',
  },
  {
    displayName: 'Description',
    name: 'description',
    type: 'string',
    required: false,

    default: '',
  },
  {
    displayName: 'AdminContactIds  - List',
    name: 'adminContactIdsList',
    type: 'fixedCollection',
    typeOptions: {
      multipleValues: true,
    },
    default: {},
    options: [
      {
        name: 'collection',
        displayName: 'Collection',
        values: [
          {
            displayName: 'AdminContactIds',
            name: 'adminContactIds',
            type: 'number',


            default: 0,
          },
        ],
      },
    ],
  },
];

const displayOptions = {
  show: {
    resource: ['GroupCommandService'],
    operation: ['GroupNewStandardGroup'],
  },
};

export const description = updateDisplayOptions(displayOptions, properties);

export async function execute(this: IExecuteFunctions, index: number, client: OlvidClient): Promise<INodeExecutionData[]> {
    const name: string | undefined = this.getNodeParameter('name', index) ? this.getNodeParameter('name', index) as string : undefined;
    const description: string | undefined = this.getNodeParameter('description', index) ? this.getNodeParameter('description', index) as string : undefined;
    function getAdminContactIds(this: IExecuteFunctions, index: number): bigint[] {
        const adminContactIdsCollectionParent: IDataObject | undefined = this.getNodeParameter('adminContactIdsList', index) as IDataObject | undefined;
        if (adminContactIdsCollectionParent === undefined) {
            return [];
        }
        const adminContactIdsCollection: IDataObject[] | undefined = adminContactIdsCollectionParent['collection'] as IDataObject[] | undefined;
        if (adminContactIdsCollection === undefined) {
            return [];
        }
        const adminContactIdsList: bigint[] = [];
        for (const itemAdminContactIds of adminContactIdsCollection) {
            const adminContactIds: bigint = BigInt(itemAdminContactIds['adminContactIds'] as number);
            adminContactIdsList.push(adminContactIds);
        }
        return adminContactIdsList;
    }
    const adminContactIds: bigint[] = getAdminContactIds.call(this, index);
    const response: commands.GroupNewStandardGroupResponse = await client.stubs.groupCommandStub.groupNewStandardGroup({name, description, adminContactIds});
    return this.helpers.returnJsonArray({id: Number(response?.group?.id), type: datatypes.Group_Type[response?.group?.type ?? 0], advancedConfiguration: {readOnly: response?.group?.advancedConfiguration?.readOnly, remoteDelete: datatypes.Group_AdvancedConfiguration_RemoteDelete[response?.group?.advancedConfiguration?.remoteDelete ?? 0]}, ownPermissions: {admin: response?.group?.ownPermissions?.admin, remoteDeleteAnything: response?.group?.ownPermissions?.remoteDeleteAnything, editOrRemoteDeleteOwnMessages: response?.group?.ownPermissions?.editOrRemoteDeleteOwnMessages, changeSettings: response?.group?.ownPermissions?.changeSettings, sendMessage: response?.group?.ownPermissions?.sendMessage}, members: response?.group?.members.map(e => ({contactId: Number(e.contactId), permissions: {admin: e.permissions?.admin, remoteDeleteAnything: e.permissions?.remoteDeleteAnything, editOrRemoteDeleteOwnMessages: e.permissions?.editOrRemoteDeleteOwnMessages, changeSettings: e.permissions?.changeSettings, sendMessage: e.permissions?.sendMessage}})), pendingMembers: response?.group?.pendingMembers.map(e => ({pendingMemberId: Number(e.pendingMemberId), contactId: Number(e.contactId), displayName: e.displayName, declined: e.declined, permissions: {admin: e.permissions?.admin, remoteDeleteAnything: e.permissions?.remoteDeleteAnything, editOrRemoteDeleteOwnMessages: e.permissions?.editOrRemoteDeleteOwnMessages, changeSettings: e.permissions?.changeSettings, sendMessage: e.permissions?.sendMessage}})), updateInProgress: response?.group?.updateInProgress, keycloakManaged: response?.group?.keycloakManaged, name: response?.group?.name, description: response?.group?.description, hasAPhoto: response?.group?.hasAPhoto});
}
