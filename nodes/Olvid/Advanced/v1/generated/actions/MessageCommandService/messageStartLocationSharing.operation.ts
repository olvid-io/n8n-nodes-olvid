// @generated by protoc-gen-n8n-actions v1 with parameter "target=ts"
// @generated from file olvid/daemon/services/v1/command_service.proto (package olvid.daemon.services.v1, syntax proto3)
/* eslint-disable */

import { type IExecuteFunctions, type INodeExecutionData, type IDataObject, type INodeProperties, updateDisplayOptions } from 'n8n-workflow';

// noinspection ES6UnusedImports
import { datatypes, OlvidClient, commands } from '@olvid/bot-node';

const properties: INodeProperties[] = [
  {
    displayName: 'DiscussionId',
    name: 'discussionId',
    type: 'number',
    required: true,

    default: 0,
  },
  {
    displayName: 'Latitude',
    name: 'latitude',
    type: 'number',
    required: true,

    default: 0,
  },
  {
    displayName: 'Longitude',
    name: 'longitude',
    type: 'number',
    required: true,

    default: 0,
  },
  {
    displayName: 'Altitude',
    name: 'altitude',
    type: 'number',
    required: false,

    default: 0,
  },
  {
    displayName: 'Precision',
    name: 'precision',
    type: 'number',
    required: false,

    default: 0,
  },
];

const displayOptions = {
  show: {
    resource: ['MessageCommandService'],
    operation: ['MessageStartLocationSharing'],
  },
};

export const description = updateDisplayOptions(displayOptions, properties);

export async function execute(this: IExecuteFunctions, index: number, client: OlvidClient): Promise<INodeExecutionData[]> {
    const discussionId: bigint = BigInt(this.getNodeParameter('discussionId', index) as number);
    const latitude: number = this.getNodeParameter('latitude', index) as number;
    const longitude: number = this.getNodeParameter('longitude', index) as number;
    const altitude: number | undefined = this.getNodeParameter('altitude', index) ? this.getNodeParameter('altitude', index) as number : undefined;
    const precision: number | undefined = this.getNodeParameter('precision', index) ? this.getNodeParameter('precision', index) as number : undefined;
    const response: commands.MessageStartLocationSharingResponse = await client.stubs.messageCommandStub.messageStartLocationSharing({discussionId, latitude, longitude, altitude, precision});
    return this.helpers.returnJsonArray({id: {type: datatypes.MessageId_Type[response?.message?.id?.type ?? 0], id: Number(response?.message?.id?.id)}, discussionId: Number(response?.message?.discussionId), senderId: Number(response?.message?.senderId), body: response?.message?.body, sortIndex: response?.message?.sortIndex, timestamp: Number(response?.message?.timestamp), attachmentsCount: Number(response?.message?.attachmentsCount), repliedMessageId: {type: datatypes.MessageId_Type[response?.message?.repliedMessageId?.type ?? 0], id: Number(response?.message?.repliedMessageId?.id)}, messageLocation: {type: datatypes.MessageLocation_LocationType[response?.message?.messageLocation?.type ?? 0], timestamp: Number(response?.message?.messageLocation?.timestamp), latitude: response?.message?.messageLocation?.latitude, longitude: response?.message?.messageLocation?.longitude, altitude: response?.message?.messageLocation?.altitude, precision: response?.message?.messageLocation?.precision, address: response?.message?.messageLocation?.address}, reactions: response?.message?.reactions.map(e => ({contactId: Number(e.contactId), reaction: e.reaction, timestamp: Number(e.timestamp)})), forwarded: response?.message?.forwarded, editedBody: response?.message?.editedBody});
}
